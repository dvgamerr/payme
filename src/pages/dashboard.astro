---
import { getUserFromSession } from '../lib/auth.js';

// Check authentication
const sessionId = Astro.cookies.get('session_id')?.value;
const user = getUserFromSession(sessionId);

// Redirect to login if not authenticated
if (!user) {
  return Astro.redirect('/login');
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - payme</title>
    <link rel="stylesheet" href="/src/styles/global.css" />
  </head>
  <body>
    <div id="app"></div>
    <script>
      import { mount } from 'svelte';
      import { theme } from '../stores/theme.js';
      import { auth } from '../stores/auth.js';
      import DashboardPage from '../components/DashboardPage.svelte';

      // Initialize theme
      theme.init();

      // Initialize auth state
      auth.checkAuth();

      // Mount Svelte app
      const app = mount(DashboardPage, {
        target: document.getElementById('app'),
      });
    </script>
  </body>
</html>
